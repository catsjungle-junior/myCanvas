<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Examples</title>
<meta name="description" content="">
<meta name="keywords" content="">
<link href="" rel="stylesheet">
<style>
	body{text-align: center;background-color: #000;}
	#c1{background-color: #fff;}
</style>
<script src="js/resource.js"></script>
<script src="js/common.js"></script>
<script src="js/fish.js"></script>
<script src="js/cannon.js">	</script>
<script>
document.addEventListener('DOMContentLoaded', function(){

	var c1 = document.getElementById('c1');
	var gd = c1.getContext('2d');
	var aFish = [];
	var W = c1.width, H = c1.height;

	loadImages(j_imgs,function(imgs){
		
		// for(var i = 0; i < 30; i++){
		// 	var oF = new Fish(imgs.fish1, 55, 37, 0, 4);
		// 	aFish.push(oF);			
		// }
		var cannon = new Cannon(imgs.cannon1, 74, 74);
		document.onclick = function(ev){
			var x1 = ev.pageX - c1.offsetLeft;
			var y1 = ev.pageY - c1.offsetTop;

			var x2 = cannon.x ;
			var y2 = cannon.y ;

			var y = y1 - y2;
			var x = x1 - x2;
			cannon.rotate = a2d(Math.atan2(y, x))+90;

			// console.log(a2d(cannon.rotate));
		};
		
		
		var fishes = [
			{img:imgs.fish1, w: 55, h: 37},
			{img:imgs.fish2, w: 78, h: 64},
			{img:imgs.fish3, w: 72, h: 56},
			{img:imgs.fish4, w: 77, h: 59},
			{img:imgs.fish5, w: 107, h: 122}
		]
		function next(){
			setTimeout(function(){
				var fish = fishes[Math.floor(Math.random()*fishes.length)];

				var oF = new Fish(fish.img, fish.w, fish.h, 0, 4);

				aFish.push(oF);

				next();
			},Math.random()*500);
		}

		next();

		// 移动、绘制
		setInterval(function(){
			gd.clearRect(0, 0, c1.width, c1.height);

			for(var i=0;i<aFish.length;i++){
				aFish[i].move();
				aFish[i].draw(gd);
			}
					
			
			gd.drawImage(imgs.bottom, 0, 0, 765, 71, 15, 529, 765, 71);

			cannon.draw(gd);
		},16);
		// 换帧
		setInterval(function(){
			for(var i=0;i<aFish.length;i++){
				aFish[i].nextFrame();
			}
		},150);
	},  function(){
		alert('加载失败，请刷新重试')
	});
}, false);
	
</script>
</head>
<body>
   <canvas id="c1" width="800" height="600"></canvas>
</body>
</html>